<!DOCTYPE html>
<html lang="vi" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate"> <title>English Tech Master - THCS</title>
    <style>
        /* --- CSS: GIAO DI·ªÜN XANH T√çM C√îNG NGH·ªÜ --- */
        :root {
            --primary: #00f2ff;
            --secondary: #bc13fe;
            --bg-dark: #0a0a20;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(circle at center, #1a0b2e, #000000);
            color: white;
            margin: 0;
            overflow-x: hidden;
            user-select: none; /* Ch·ªëng b√¥i ƒëen copy */
            -webkit-user-select: none;
        }

        /* Hi·ªáu ·ª©ng n·ªÅn */
        .bg-tech {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(188, 19, 254, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }

        h1, h2 {
            text-transform: uppercase;
            text-shadow: 0 0 10px var(--primary), 0 0 20px var(--secondary);
        }

        /* Khung nh·∫≠p li·ªáu & N√∫t b·∫•m */
        input, select {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--primary);
            color: white;
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            font-size: 16px;
            outline: none;
        }

        button {
            background: linear-gradient(45deg, var(--secondary), var(--primary));
            border: none;
            padding: 12px 30px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            border-radius: 25px;
            box-shadow: 0 0 15px var(--secondary);
            transition: 0.3s;
            margin: 10px;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px var(--primary);
        }

        /* C√°c m√†n h√¨nh */
        .screen { display: none; animation: fadeIn 0.5s; }
        .screen.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Khu v·ª±c c√¢u h·ªèi */
        .quiz-box {
            background: var(--glass);
            border: 1px solid var(--primary);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            margin-top: 20px;
        }

        .question-text { font-size: 22px; margin-bottom: 20px; color: #fff; }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--primary);
            box-shadow: none;
        }

        /* Thanh th√¥ng tin */
        .hud {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 10px;
            border-bottom: 3px solid var(--secondary);
            margin-bottom: 15px;
        }

        /* Th√¥ng b√°o k·∫øt qu·∫£ */
        .feedback {
            font-size: 18px;
            font-weight: bold;
            height: 30px;
            margin-top: 10px;
        }
        .correct { color: #00ff00; text-shadow: 0 0 10px #00ff00; }
        .wrong { color: #ff0000; text-shadow: 0 0 10px #ff0000; }

        /* Th·ªëng k√™ */
        .stats-box {
            font-size: 14px;
            color: #aaa;
            margin-top: 50px;
            border-top: 1px solid #333;
            padding-top: 10px;
        }

        /* Ph·∫ßn th∆∞·ªüng */
        .reward-gem {
            font-size: 50px;
            animation: bounce 2s infinite;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

    </style>
</head>
<body>

    <div class="bg-tech"></div>
    
    <audio id="bgMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <div class="container">
        <div id="loginScreen" class="screen active">
            <h1>English Tech Arena</h1>
            <p>H·ªá th·ªëng √¥n luy·ªán ti·∫øng Anh THCS</p>
            <div class="quiz-box">
                <input type="text" id="username" placeholder="H·ªç v√† T√™n" required>
                <input type="text" id="userclass" placeholder="L·ªõp (V√≠ d·ª•: 8A)" required>
                <br>
                <button onclick="checkUserAndStart()">B·∫ÆT ƒê·∫¶U CHI·∫æN ƒê·∫§U</button>
            </div>
            <div class="stats-box">
                <p>S·ªë l∆∞·ª£ng truy c·∫≠p h·ªá th·ªëng: <span id="visitCount">Loading...</span></p>
            </div>
        </div>

        <div id="gameScreen" class="screen">
            <div class="hud">
                <span>Time: <span id="timer">25:00</span></span>
                <span>Score: <span id="score">0</span>/100</span>
                <span>Q: <span id="qCount">1</span>/20</span>
            </div>
            <button onclick="toggleMusic()" style="font-size: 12px; padding: 5px 10px; position: absolute; top: 10px; right: 10px;">üéµ Music On/Off</button>
            
            <div class="quiz-box">
                <h3 id="qType" style="color: var(--secondary)">Lo·∫°i c√¢u h·ªèi</h3>
                <div id="questionDisplay" class="question-text">Loading...</div>
                <div id="optionsArea" class="options-grid">
                    </div>
                <div id="inputArea" style="display:none;">
                    <input type="text" id="textAnswer" placeholder="Nh·∫≠p ƒë√°p √°n c·ªßa b·∫°n...">
                    <button onclick="submitTextAnswer()">G·ª≠i ƒê√°p √Ån</button>
                </div>
                <div id="feedback" class="feedback"></div>
            </div>
        </div>

        <div id="resultScreen" class="screen">
            <h1>K·∫æT QU·∫¢ M√ÄN CH∆†I</h1>
            <div class="quiz-box">
                <h2 id="finalScore">0 ƒêi·ªÉm</h2>
                <h3 id="gradeRank" style="color: var(--primary)"></h3>
                <div id="rewardArea"></div>
                <button onclick="nextLevel()">M√†n Ti·∫øp Theo (Reset)</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. D·ªÆ LI·ªÜU C√ÇU H·ªéI (M·∫™U) ---
        // B·∫°n c·∫ßn d√πng AI ho·∫∑c Excel ƒë·ªÉ t·∫°o ra 3000 d√≤ng t∆∞∆°ng t·ª± v√† d√°n v√†o ƒë√¢y ho·∫∑c load file json
        // Types: 1=Gh√©p t·ª´, 2=Tr·∫Øc nghi·ªám, 3=T√¨m l·ªói sai, 4=S·ª≠a c√¢u
        const fullQuestionDatabase = [
            // M·∫´u Tr·∫Øc nghi·ªám (Type 2)
            { id: 1, type: 2, q: "Choose the correct answer: She _____ to school everyday.", options: ["go", "goes", "going", "went"], correct: "goes" },
            { id: 2, type: 2, q: "What is the past tense of 'buy'?", options: ["buyed", "bought", "buying", "buys"], correct: "bought" },
            { id: 3, type: 2, q: "He is _____ than his brother.", options: ["tall", "taller", "more tall", "tallest"], correct: "taller" },
            // M·∫´u Gh√©p t·ª´ (Type 1 - User x·∫øp l·∫°i c√¢u)
            { id: 4, type: 1, q: "Arrange: is / name / My / John.", correct: "My name is John" },
            { id: 5, type: 1, q: "Arrange: you / How / are / old ?", correct: "How old are you" },
            // M·∫´u T√¨m l·ªói sai (Type 3)
            { id: 6, type: 3, q: "Find error: She don't like playing football.", options: ["She", "don't", "like", "playing"], correct: "don't" },
            // M·∫´u S·ª≠a c√¢u (Type 4)
            { id: 7, type: 4, q: "Correct the sentence: He play soccer yesterday.", correct: "He played soccer yesterday" },
            // ... B·∫°n c·∫ßn th√™m ƒë·ªß √≠t nh·∫•t 20 c√¢u ƒë·ªÉ test, th·ª±c t·∫ø c·∫ßn 3000 c√¢u
        ];
        
        // ƒê·ªÉ demo ho·∫°t ƒë·ªông, m√¨nh s·∫Ω nh√¢n b·∫£n c√¢u h·ªèi l√™n cho ƒë·ªß s·ªë l∆∞·ª£ng test
        while(fullQuestionDatabase.length < 50) {
            fullQuestionDatabase.push({...fullQuestionDatabase[Math.floor(Math.random() * fullQuestionDatabase.length)], id: Date.now() + Math.random()});
        }

        // --- 2. BI·∫æN TO√ÄN C·ª§C ---
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let timerInterval;
        let timeLeft = 25 * 60; // 25 ph√∫t
        let musicPlaying = false;
        let currentUser = "";

        // --- 3. H·ªÜ TH·ªêNG TRUY C·∫¨P & LOGIN ---
        
        // Th·ªëng k√™ truy c·∫≠p (Gi·∫£ l·∫≠p b·∫±ng localStorage cho Local, th·ª±c t·∫ø c·∫ßn Server)
        let visits = localStorage.getItem('site_visits') || 0;
        visits++;
        localStorage.setItem('site_visits', visits);
        document.getElementById('visitCount').innerText = visits;

        function checkUserAndStart() {
            const name = document.getElementById('username').value.trim();
            const lop = document.getElementById('userclass').value.trim();

            if (!name || !lop) {
                alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß H·ªç t√™n v√† L·ªõp!");
                return;
            }

            // Gi·ªõi h·∫°n s·ªë l·∫ßn l√†m b√†i (V√≠ d·ª•: 3 l·∫ßn)
            const userKey = `user_${name}_${lop}`;
            let attempts = localStorage.getItem(userKey) || 0;
            
            // B·ªè comment d√≤ng d∆∞·ªõi n·∫øu mu·ªën ch·∫∑n th·∫≠t
            // if (attempts >= 3) { alert("B·∫°n ƒë√£ h·∫øt l∆∞·ª£t l√†m b√†i!"); return; }

            attempts++;
            localStorage.setItem(userKey, attempts);
            currentUser = name;

            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            
            startLevel();
        }

        // --- 4. LOGIC GAMEPLAY ---

        function startLevel() {
            // Reset tr·∫°ng th√°i
            score = 0;
            currentIndex = 0;
            timeLeft = 25 * 60; 
            updateUI();
            
            // Random b·ªô c√¢u h·ªèi m·ªõi (20 c√¢u)
            currentQuestions = getRandomQuestions(20);
            
            // B·∫Øt ƒë·∫ßu nh·∫°c n·∫øu ch∆∞a b·∫≠t
            const audio = document.getElementById('bgMusic');
            if(!musicPlaying) {
                audio.volume = 0.3;
                // audio.play().catch(e => console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c"));
                // musicPlaying = true; 
            }

            startTimer();
            loadQuestion();
        }

        function getRandomQuestions(amount) {
            // X√°o tr·ªôn m·∫£ng g·ªëc v√† l·∫•y ra 'amount' c√¢u
            const shuffled = [...fullQuestionDatabase].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, amount);
        }

        function loadQuestion() {
            if (currentIndex >= currentQuestions.length) {
                finishLevel();
                return;
            }

            const q = currentQuestions[currentIndex];
            document.getElementById('qCount').innerText = currentIndex + 1;
            document.getElementById('questionDisplay').innerText = q.q;
            document.getElementById('feedback').innerText = "";
            document.getElementById('feedback').className = "feedback";

            const optionsArea = document.getElementById('optionsArea');
            const inputArea = document.getElementById('inputArea');
            optionsArea.innerHTML = "";
            
            // Set ti√™u ƒë·ªÅ lo·∫°i
            let typeName = "";
            if(q.type === 1) typeName = "GH√âP T·ª™ / S·∫ÆP X·∫æP C√ÇU";
            if(q.type === 2) typeName = "TR·∫ÆC NGHI·ªÜM";
            if(q.type === 3) typeName = "T√åM L·ªñI SAI";
            if(q.type === 4) typeName = "S·ª¨A C√ÇU";
            document.getElementById('qType').innerText = typeName;

            // X·ª≠ l√Ω hi·ªÉn th·ªã theo lo·∫°i
            if (q.type === 2 || q.type === 3) {
                // Tr·∫Øc nghi·ªám & T√¨m l·ªói sai: Hi·ªán n√∫t
                inputArea.style.display = 'none';
                optionsArea.style.display = 'grid';
                q.options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerText = opt;
                    btn.onclick = () => checkAnswer(opt);
                    optionsArea.appendChild(btn);
                });
            } else {
                // Gh√©p t·ª´ & S·ª≠a c√¢u: Hi·ªán √¥ nh·∫≠p li·ªáu
                optionsArea.style.display = 'none';
                inputArea.style.display = 'block';
                document.getElementById('textAnswer').value = '';
                document.getElementById('textAnswer').focus();
            }
        }

        function submitTextAnswer() {
            const val = document.getElementById('textAnswer').value.trim();
            checkAnswer(val);
        }

        function checkAnswer(userAns) {
            const q = currentQuestions[currentIndex];
            // So s√°nh kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng
            const isCorrect = userAns.toLowerCase() === q.correct.toLowerCase();

            if (isCorrect) {
                // ƒê√öNG
                score += 5; // 20 c√¢u * 5 ƒëi·ªÉm = 100
                document.getElementById('score').innerText = score;
                showFeedback("CORRECT! +5 Points", true);
                setTimeout(() => {
                    currentIndex++;
                    loadQuestion();
                }, 1000);
            } else {
                // SAI -> ƒê·ªïi c√¢u h·ªèi kh√°c
                showFeedback("WRONG! Changing Question...", false);
                setTimeout(() => {
                    replaceCurrentQuestion();
                }, 1500);
            }
        }

        function replaceCurrentQuestion() {
            // L·∫•y 1 c√¢u ng·∫´u nhi√™n t·ª´ DB kh√¥ng tr√πng v·ªõi b·ªô hi·ªán t·∫°i
            const remainingPool = fullQuestionDatabase.filter(x => !currentQuestions.includes(x));
            if (remainingPool.length > 0) {
                const newQ = remainingPool[Math.floor(Math.random() * remainingPool.length)];
                currentQuestions[currentIndex] = newQ; // Thay th·∫ø c√¢u hi·ªán t·∫°i
                loadQuestion(); // Load l·∫°i c√¢u m·ªõi ·ªü v·ªã tr√≠ hi·ªán t·∫°i
            } else {
                alert("H·∫øt c√¢u h·ªèi d·ª± tr·ªØ! B·∫°n ph·∫£i l√†m l·∫°i c√¢u n√†y.");
                loadQuestion();
            }
        }

        function showFeedback(msg, isGood) {
            const fb = document.getElementById('feedback');
            fb.innerText = msg;
            fb.className = isGood ? "feedback correct" : "feedback wrong";
        }

        // --- 5. TIMER & K·∫æT TH√öC ---

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("H·∫æT GI·ªú! B·∫°n ph·∫£i l√†m l·∫°i b·ªô c√¢u h·ªèi m·ªõi.");
                    startLevel(); // Reset
                }
            }, 1000);
        }

        function finishLevel() {
            clearInterval(timerInterval);
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.add('active');

            // T√≠nh x·∫øp lo·∫°i
            const finalScore = score;
            let rank = "";
            let color = "";
            
            if (finalScore < 50) { rank = "CH∆ØA ƒê·∫†T"; color = "red"; }
            else if (finalScore < 65) { rank = "ƒê·∫†T"; color = "orange"; }
            else if (finalScore < 80) { rank = "KH√Å"; color = "yellow"; }
            else if (finalScore < 90) { rank = "GI·ªéI"; color = "cyan"; }
            else { rank = "XU·∫§T S·∫ÆC"; color = "#bc13fe"; }

            document.getElementById('finalScore').innerText = `${finalScore} / 100`;
            const rankEl = document.getElementById('gradeRank');
            rankEl.innerText = rank;
            rankEl.style.color = color;

            // Ph·∫ßn th∆∞·ªüng
            const rewardDiv = document.getElementById('rewardArea');
            if (finalScore >= 50) {
                rewardDiv.innerHTML = `<div class="reward-gem">üíé</div><p>B·∫°n nh·∫≠n ƒë∆∞·ª£c 1 vi√™n ƒê√° Qu√Ω C√¥ng Ngh·ªá!</p>`;
            } else {
                rewardDiv.innerHTML = `<p>C·ªë g·∫Øng h∆°n l·∫ßn sau nh√©!</p>`;
            }
        }

        function nextLevel() {
            document.getElementById('resultScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            startLevel(); // B·∫Øt ƒë·∫ßu m√†n m·ªõi (reset timer, c√¢u h·ªèi m·ªõi)
        }

        function updateUI() {
            document.getElementById('score').innerText = score;
        }

        function toggleMusic() {
            const audio = document.getElementById('bgMusic');
            if (audio.paused) {
                audio.play();
                musicPlaying = true;
            } else {
                audio.pause();
                musicPlaying = false;
            }
        }
    </script>
</body>
</html>
