<!DOCTYPE html>
<html lang="vi" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>English Tech Master - THCS</title>
    <style>
        :root {
            --bg-color: #0f0c29;
            --gradient: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            --neon-blue: #00f2ff;
            --neon-purple: #bc13fe;
            --text-color: #fff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-color);
            background-image: var(--gradient);
            color: var(--text-color);
            margin: 0; padding: 0; height: 100vh;
            overflow: hidden; user-select: none;
            display: flex; align-items: center; justify-content: center;
        }

        /* Hi·ªáu ·ª©ng background c√¥ng ngh·ªá */
        #bg-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }

        .container > div {
            background: rgba(15, 12, 41, 0.85);
            backdrop-filter: blur(15px);
            padding: 30px; border-radius: 20px;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.2);
            text-align: center; width: 90%; max-width: 600px;
            display: none; animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        input {
            width: 80%; padding: 12px; margin: 10px 0;
            background: rgba(255,255,255,0.05); border: 1px solid var(--neon-blue);
            color: white; border-radius: 8px; outline: none;
        }

        button {
            padding: 12px 25px; margin: 10px;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple));
            border: none; color: white; font-weight: bold;
            cursor: pointer; border-radius: 50px; transition: 0.3s;
        }

        button:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--neon-blue); }

        .hud { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .music-control { position: fixed; top: 20px; right: 20px; cursor: pointer; font-size: 24px; z-index: 100; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { color: var(--neon-blue); padding: 10px; border-bottom: 1px solid #444; }
        td { padding: 8px; border-bottom: 1px solid #222; }
    </style>
</head>
<body oncontextmenu="return false;">

    <canvas id="bg-canvas"></canvas>

    <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8c8a73467.mp3?filename=cyberpunk-2099-105864.mp3" type="audio/mpeg">
    </audio>
    
    <div class="music-control" onclick="toggleMusic()">üîá</div>

    <div class="container">
        <div id="login-screen" style="display: block;">
            <h2>TECH ENGLISH MASTER</h2>
            <input type="text" id="player-name" placeholder="H·ªç v√† T√™n">
            <input type="text" id="player-class" placeholder="L·ªõp">
            <br>
            <button onclick="startGame()">B·∫ÆT ƒê·∫¶U</button>
            <button onclick="showLeaderboard()">X·∫æP H·∫†NG</button>
        </div>

        <div id="game-screen">
            <div class="hud">
                <span id="display-info">...</span>
                <span id="timer" style="color:red">25:00</span>
                <span id="score" style="color:lime">0</span>
            </div>
            <h4 id="question-type-title" style="color: var(--neon-blue)">Loading...</h4>
            <div id="question-text" style="font-size: 1.2rem; margin-bottom: 20px;"></div>
            <div id="answer-area"></div>
            <div id="feedback" style="margin-top: 15px; min-height: 20px;"></div>
        </div>

        <div id="result-screen">
            <h2>HO√ÄN TH√ÄNH!</h2>
            <p id="final-score"></p>
            <div style="font-size: 3rem;">üíé <span id="gems">0</span></div>
            <button onclick="location.reload()">CH∆†I L·∫†I</button>
        </div>

        <div id="leaderboard-screen">
            <h3>TOP 10 CHI·∫æN BINH</h3>
            <table id="leaderboard-table">
                <thead><tr><th>H·∫°ng</th><th>T√™n</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr></thead>
                <tbody></tbody>
            </table>
            <button onclick="showScreen('login-screen')">QUAY V·ªÄ</button>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu c√¢u h·ªèi (R√∫t g·ªçn ƒë·ªÉ tr√°nh l·ªói, b·∫°n c√≥ th·ªÉ th√™m ti·∫øp v√†o ƒë√¢y)
        const fullQuestionBank = [
            { id: 1, type: 1, question: "She _______ her homework at the moment.", options: ["is doing", "does", "did", "has done"], answer: "is doing" },
{ id: 2, type: 1, question: "We _______ this film three times already.", options: ["saw", "see", "have seen", "are seeing"], answer: "have seen" },
{ id: 3, type: 1, question: "When I arrived, they _______ dinner.", options: ["were having", "have", "had", "are having"], answer: "were having" },
{ id: 4, type: 1, question: "By 2025, she _______ from university.", options: ["will graduate", "graduates", "will have graduated", "is graduating"], answer: "will have graduated" },
{ id: 5, type: 1, question: "He usually _______ to school by bike.", options: ["go", "goes", "went", "is going"], answer: "goes" },
{ id: 6, type: 1, question: "I _______ English for five years.", options: ["learn", "learned", "have learned", "am learning"], answer: "have learned" },
{ id: 7, type: 1, question: "She _______ TV when I called her.", options: ["watched", "was watching", "has watched", "watches"], answer: "was watching" },
{ id: 8, type: 1, question: "They _______ here since 2010.", options: ["live", "lived", "have lived", "are living"], answer: "have lived" },
{ id: 9, type: 1, question: "My father _______ home late last night.", options: ["comes", "came", "has come", "is coming"], answer: "came" },
{ id: 10, type: 1, question: "Look! It _______ heavily.", options: ["rains", "rained", "is raining", "has rained"], answer: "is raining" },

{ id: 11, type: 1, question: "She _______ already _______ dinner.", options: ["has / cooked", "is / cooking", "was / cooking", "will / cook"], answer: "has / cooked" },
{ id: 12, type: 1, question: "We _______ to the beach tomorrow.", options: ["go", "went", "will go", "have gone"], answer: "will go" },
{ id: 13, type: 1, question: "He _______ a book when the phone rang.", options: ["reads", "read", "was reading", "has read"], answer: "was reading" },
{ id: 14, type: 1, question: "She _______ never _______ sushi before.", options: ["has / eaten", "is / eating", "was / eating", "will / eat"], answer: "has / eaten" },
{ id: 15, type: 1, question: "By the time we arrived, the train _______.", options: ["leaves", "left", "had left", "has left"], answer: "had left" },

{ id: 16, type: 1, question: "I _______ him since last year.", options: ["don‚Äôt see", "didn‚Äôt see", "haven‚Äôt seen", "won‚Äôt see"], answer: "haven‚Äôt seen" },
{ id: 17, type: 1, question: "She _______ to music every evening.", options: ["listen", "listens", "listened", "is listening"], answer: "listens" },
{ id: 18, type: 1, question: "They _______ football when it started to rain.", options: ["play", "played", "were playing", "have played"], answer: "were playing" },
{ id: 19, type: 1, question: "He _______ his keys, so he can't open the door.", options: ["loses", "lost", "has lost", "is losing"], answer: "has lost" },
{ id: 20, type: 1, question: "She _______ as a teacher for ten years.", options: ["works", "worked", "has worked", "is working"], answer: "has worked" },

{ id: 21, type: 1, question: "I _______ my homework before dinner yesterday.", options: ["finish", "finished", "had finished", "have finished"], answer: "had finished" },
{ id: 22, type: 1, question: "He _______ a car last month.", options: ["buys", "bought", "has bought", "is buying"], answer: "bought" },
{ id: 23, type: 1, question: "She _______ for the bus when I saw her.", options: ["waits", "waited", "was waiting", "has waited"], answer: "was waiting" },
{ id: 24, type: 1, question: "We _______ English every Monday.", options: ["study", "studied", "have studied", "are studying"], answer: "study" },
{ id: 25, type: 1, question: "They _______ in this house since they got married.", options: ["live", "lived", "have lived", "are living"], answer: "have lived" },

{ id: 26, type: 1, question: "She _______ tired because she worked late.", options: ["is", "was", "has been", "will be"], answer: "was" },
{ id: 27, type: 1, question: "He _______ his homework yet.", options: ["doesn‚Äôt finish", "didn‚Äôt finish", "hasn‚Äôt finished", "won‚Äôt finish"], answer: "hasn‚Äôt finished" },
{ id: 28, type: 1, question: "When we got there, the movie _______.", options: ["starts", "started", "had started", "has started"], answer: "had started" },
{ id: 29, type: 1, question: "She _______ to Paris twice.", options: ["goes", "went", "has gone", "is going"], answer: "has gone" },
{ id: 30, type: 1, question: "I _______ him tomorrow.", options: ["meet", "met", "will meet", "have met"], answer: "will meet" },

{ id: 31, type: 1, question: "He _______ breakfast when I arrived.", options: ["has", "had", "was having", "is having"], answer: "was having" },
{ id: 32, type: 1, question: "She _______ a letter at the moment.", options: ["writes", "wrote", "is writing", "has written"], answer: "is writing" },
{ id: 33, type: 1, question: "They _______ the house before 2010.", options: ["build", "built", "had built", "have built"], answer: "had built" },
{ id: 34, type: 1, question: "I _______ my friend every weekend.", options: ["visit", "visited", "have visited", "am visiting"], answer: "visit" },
{ id: 35, type: 1, question: "She _______ asleep when the phone rang.", options: ["falls", "fell", "was falling", "has fallen"], answer: "was falling" },

{ id: 36, type: 1, question: "He _______ English very well.", options: ["speak", "speaks", "spoke", "has spoken"], answer: "speaks" },
{ id: 37, type: 1, question: "We _______ lunch when she came.", options: ["have", "had", "were having", "are having"], answer: "were having" },
{ id: 38, type: 1, question: "She _______ her keys an hour ago.", options: ["loses", "lost", "has lost", "is losing"], answer: "lost" },
{ id: 39, type: 1, question: "I _______ never _______ such a beautiful place.", options: ["have / seen", "am / seeing", "was / seeing", "will / see"], answer: "have / seen" },
{ id: 40, type: 1, question: "They _______ dinner before we arrived.", options: ["finish", "finished", "had finished", "have finished"], answer: "had finished" },

{ id: 41, type: 1, question: "She usually _______ up at 6 a.m.", options: ["get", "gets", "got", "is getting"], answer: "gets" },
{ id: 42, type: 1, question: "He _______ TV right now.", options: ["watches", "watched", "is watching", "has watched"], answer: "is watching" },
{ id: 43, type: 1, question: "They _______ to Hanoi last summer.", options: ["go", "went", "have gone", "are going"], answer: "went" },
{ id: 44, type: 1, question: "I _______ my homework already.", options: ["do", "did", "have done", "am doing"], answer: "have done" },
{ id: 45, type: 1, question: "She _______ when the teacher entered the room.", options: ["talks", "talked", "was talking", "has talked"], answer: "was talking" },

{ id: 46, type: 1, question: "We _______ English since primary school.", options: ["learn", "learned", "have learned", "are learning"], answer: "have learned" },
{ id: 47, type: 1, question: "He _______ the door before he left.", options: ["locks", "locked", "had locked", "has locked"], answer: "had locked" },
{ id: 48, type: 1, question: "She _______ very happy yesterday.", options: ["is", "was", "has been", "will be"], answer: "was" },
{ id: 49, type: 1, question: "I _______ to music while doing homework.", options: ["listen", "listened", "am listening", "have listened"], answer: "am listening" },
{ id: 50, type: 1, question: "They _______ in this city for a long time.", options: ["live", "lived", "have lived", "are living"], answer: "have lived" }

{ id: 51, type: 4, question: "Rewrite: They clean the classroom every day.", answer: "The classroom is cleaned every day" },
{ id: 52, type: 4, question: "Rewrite: She wrote this letter yesterday.", answer: "This letter was written yesterday" },
{ id: 53, type: 4, question: "Rewrite: They will build a new hospital.", answer: "A new hospital will be built" },
{ id: 54, type: 4, question: "Rewrite: People speak English all over the world.", answer: "English is spoken all over the world" },
{ id: 55, type: 4, question: "Rewrite: Someone has stolen my phone.", answer: "My phone has been stolen" },

{ id: 56, type: 4, question: "Rewrite: They are repairing the road now.", answer: "The road is being repaired now" },
{ id: 57, type: 4, question: "Rewrite: He finished his homework last night.", answer: "His homework was finished last night" },
{ id: 58, type: 4, question: "Rewrite: They have built this bridge recently.", answer: "This bridge has been built recently" },
{ id: 59, type: 4, question: "Rewrite: She will invite him to the party.", answer: "He will be invited to the party" },
{ id: 60, type: 4, question: "Rewrite: They don't allow students to use phones.", answer: "Students are not allowed to use phones" },

/* ----- Multiple choice (Type 1) ----- */
{ id: 61, type: 1, question: "The house _______ last year.", options: ["build", "built", "was built", "is built"], answer: "was built" },
{ id: 62, type: 1, question: "English _______ in many countries.", options: ["speaks", "is spoken", "spoke", "has spoken"], answer: "is spoken" },
{ id: 63, type: 1, question: "The homework _______ by the students.", options: ["do", "did", "is done", "has done"], answer: "is done" },
{ id: 64, type: 1, question: "The letter _______ tomorrow.", options: ["will send", "will be sent", "is sent", "has sent"], answer: "will be sent" },
{ id: 65, type: 1, question: "The room _______ every day.", options: ["cleans", "is cleaned", "cleaned", "has cleaned"], answer: "is cleaned" },

{ id: 66, type: 1, question: "The car _______ repaired at the moment.", options: ["is", "is being", "has been", "was"], answer: "is being" },
{ id: 67, type: 1, question: "My bike _______ stolen last night.", options: ["is", "was", "has", "has been"], answer: "was" },
{ id: 68, type: 1, question: "This book _______ written by a famous author.", options: ["is", "was", "has", "is being"], answer: "was" },
{ id: 69, type: 1, question: "The test _______ next Monday.", options: ["will hold", "will be held", "is held", "has held"], answer: "will be held" },
{ id: 70, type: 1, question: "The cake _______ by my mother.", options: ["makes", "made", "is made", "has made"], answer: "is made" },

/* ----- Error identification (Type 3) ----- */
{ id: 71, type: 3, question: "The homework *are* *done* *by* *students*.", options: ["are", "done", "by", "students"], answer: "are" },
{ id: 72, type: 3, question: "The letter *was* *send* *yesterday*.", options: ["was", "send", "yesterday"], answer: "send" },
{ id: 73, type: 3, question: "English *is* *speak* *here*.", options: ["is", "speak", "here"], answer: "speak" },
{ id: 74, type: 3, question: "The house *is* *build* *last year*.", options: ["is", "build", "last year"], answer: "build" },
{ id: 75, type: 3, question: "The book *were* *written* *by* *him*.", options: ["were", "written", "by", "him"], answer: "were" },

{ id: 76, type: 3, question: "The room *is* *clean* *every day*.", options: ["is", "clean", "every day"], answer: "clean" },
{ id: 77, type: 3, question: "The car *has* *repair* *recently*.", options: ["has", "repair", "recently"], answer: "repair" },
{ id: 78, type: 3, question: "This song *is* *sing* *by* *her*.", options: ["is", "sing", "by", "her"], answer: "sing" },
{ id: 79, type: 3, question: "The windows *are* *break* *by* *the wind*.", options: ["are", "break", "by", "the wind"], answer: "break" },
{ id: 80, type: 3, question: "The problem *was* *solve* *quickly*.", options: ["was", "solve", "quickly"], answer: "solve" },

/* ----- Rewrite (mixed tenses) ----- */
{ id: 81, type: 4, question: "Rewrite: Someone is painting the house.", answer: "The house is being painted" },
{ id: 82, type: 4, question: "Rewrite: They had finished the work before noon.", answer: "The work had been finished before noon" },
{ id: 83, type: 4, question: "Rewrite: She can solve this problem.", answer: "This problem can be solved" },
{ id: 84, type: 4, question: "Rewrite: They must obey the rules.", answer: "The rules must be obeyed" },
{ id: 85, type: 4, question: "Rewrite: Nobody has cleaned the room yet.", answer: "The room hasn't been cleaned yet" },

{ id: 86, type: 4, question: "Rewrite: They are going to open a new shop.", answer: "A new shop is going to be opened" },
{ id: 87, type: 4, question: "Rewrite: People believe that he is honest.", answer: "It is believed that he is honest" },
{ id: 88, type: 4, question: "Rewrite: They didn‚Äôt invite her to the meeting.", answer: "She wasn‚Äôt invited to the meeting" },
{ id: 89, type: 4, question: "Rewrite: Someone will announce the results tomorrow.", answer: "The results will be announced tomorrow" },
{ id: 90, type: 4, question: "Rewrite: They have just repaired the computer.", answer: "The computer has just been repaired" },

/* ----- More multiple choice ----- */
{ id: 91, type: 1, question: "The classroom _______ cleaned after school.", options: ["is", "is being", "was", "has"], answer: "is" },
{ id: 92, type: 1, question: "The dishes _______ washed by my sister.", options: ["are", "is", "were", "be"], answer: "are" },
{ id: 93, type: 1, question: "This song _______ often played on the radio.", options: ["is", "was", "has", "will"], answer: "is" },
{ id: 94, type: 1, question: "The report _______ finished tomorrow.", options: ["is", "will be", "was", "has been"], answer: "will be" },
{ id: 95, type: 1, question: "The match _______ postponed because of rain.", options: ["is", "was", "has", "will"], answer: "was" },

{ id: 96, type: 1, question: "My homework _______ checked by the teacher.", options: ["is", "are", "was", "be"], answer: "is" },
{ id: 97, type: 1, question: "The rules _______ explained clearly.", options: ["is", "are", "was", "be"], answer: "are" },
{ id: 98, type: 1, question: "The window _______ broken last night.", options: ["is", "was", "has", "is being"], answer: "was" },
{ id: 99, type: 1, question: "The project _______ completed on time.", options: ["is", "was", "has been", "will"], answer: "has been" },
{ id: 100, type: 1, question: "The cake _______ eaten already.", options: ["is", "was", "has been", "will be"], answer: "has been" }

/* ----- Type 1: Multiple choice ----- */
{ id: 101, type: 1, question: "If I _______ you, I wouldn't do that.", options: ["am", "was", "were", "be"], answer: "were" },
{ id: 102, type: 1, question: "If it rains, we _______ at home.", options: ["stay", "will stay", "stayed", "would stay"], answer: "will stay" },
{ id: 103, type: 1, question: "If she _______ harder, she would pass the exam.", options: ["studies", "studied", "study", "will study"], answer: "studied" },
{ id: 104, type: 1, question: "If we had more time, we _______ the museum.", options: ["visit", "will visit", "would visit", "visited"], answer: "would visit" },
{ id: 105, type: 1, question: "If he _______ early, he won't miss the bus.", options: ["leave", "leaves", "left", "would leave"], answer: "leaves" },

{ id: 106, type: 1, question: "If I had known about the test, I _______ harder.", options: ["study", "will study", "would study", "would have studied"], answer: "would have studied" },
{ id: 107, type: 1, question: "You will succeed if you _______ your best.", options: ["try", "tried", "will try", "would try"], answer: "try" },
{ id: 108, type: 1, question: "If she were taller, she _______ a model.", options: ["becomes", "will become", "would become", "became"], answer: "would become" },
{ id: 109, type: 1, question: "If they had left earlier, they _______ late.", options: ["won‚Äôt be", "wouldn‚Äôt be", "aren‚Äôt", "weren‚Äôt"], answer: "wouldn‚Äôt be" },
{ id: 110, type: 1, question: "If it _______ tomorrow, we will cancel the trip.", options: ["rain", "rains", "rained", "will rain"], answer: "rains" },

/* ----- Wishes (Type 4: Rewrite) ----- */
{ id: 111, type: 4, question: "Rewrite: I don't have a bike. (I wish...)", answer: "I wish I had a bike" },
{ id: 112, type: 4, question: "Rewrite: She can't swim. (She wishes...)", answer: "She wishes she could swim" },
{ id: 113, type: 4, question: "Rewrite: I am not rich. (I wish...)", answer: "I wish I were rich" },
{ id: 114, type: 4, question: "Rewrite: He didn't study hard. (He wishes...)", answer: "He wishes he had studied hard" },
{ id: 115, type: 4, question: "Rewrite: It is raining now. (I wish...)", answer: "I wish it were not raining" },

{ id: 116, type: 4, question: "Rewrite: I can't speak English well. (I wish...)", answer: "I wish I could speak English well" },
{ id: 117, type: 4, question: "Rewrite: She was late for school. (She wishes...)", answer: "She wishes she hadn't been late for school" },
{ id: 118, type: 4, question: "Rewrite: We don't live near the school. (We wish...)", answer: "We wish we lived near the school" },
{ id: 119, type: 4, question: "Rewrite: He didn't listen to my advice. (He wishes...)", answer: "He wishes he had listened to my advice" },
{ id: 120, type: 4, question: "Rewrite: I have too much homework. (I wish...)", answer: "I wish I didn't have so much homework" },

/* ----- Conditional mixed (Type 1) ----- */
{ id: 121, type: 1, question: "If she _______ more careful, she wouldn't make mistakes.", options: ["is", "was", "were", "had been"], answer: "were" },
{ id: 122, type: 1, question: "If you heat ice, it _______.", options: ["melts", "melted", "will melt", "would melt"], answer: "melts" },
{ id: 123, type: 1, question: "If I see him, I _______ him the news.", options: ["tell", "told", "will tell", "would tell"], answer: "will tell" },
{ id: 124, type: 1, question: "If we had known the way, we _______ lost.", options: ["won‚Äôt get", "wouldn‚Äôt get", "wouldn‚Äôt have got", "didn‚Äôt get"], answer: "wouldn‚Äôt have got" },
{ id: 125, type: 1, question: "If he weren't busy, he _______ us.", options: ["help", "helps", "would help", "will help"], answer: "would help" },

/* ----- Sentence rearrangement (Type 2) ----- */
{ id: 126, type: 2, question: "If / rain / it / will / stay / we / home.", answer: "If it rains we will stay home" },
{ id: 127, type: 2, question: "had / If / I / time / enough / I / would / travel.", answer: "If I had enough time I would travel" },
{ id: 128, type: 2, question: "would / you / what / do / were / rich / if / you ?", answer: "What would you do if you were rich?" },
{ id: 129, type: 2, question: "wish / I / speak / could / English / well.", answer: "I wish I could speak English well" },
{ id: 130, type: 2, question: "had / studied / he / passed / if / would / he.", answer: "If he had studied he would have passed" },

/* ----- More wishes & conditionals ----- */
{ id: 131, type: 1, question: "If she _______ earlier, she wouldn't be late now.", options: ["left", "had left", "leaves", "would leave"], answer: "had left" },
{ id: 132, type: 1, question: "I wish I _______ taller.", options: ["am", "was", "were", "be"], answer: "were" },
{ id: 133, type: 1, question: "If we save enough money, we _______ a new house.", options: ["buy", "will buy", "bought", "would buy"], answer: "will buy" },
{ id: 134, type: 1, question: "He wishes he _______ so much time playing games.", options: ["doesn't waste", "didn't waste", "hasn't wasted", "won't waste"], answer: "didn't waste" },
{ id: 135, type: 1, question: "If I were you, I _______ that job.", options: ["accept", "will accept", "would accept", "accepted"], answer: "would accept" },

{ id: 136, type: 4, question: "Rewrite: I didn't know her phone number. (I wish...)", answer: "I wish I had known her phone number" },
{ id: 137, type: 4, question: "Rewrite: He can't come today. (He wishes...)", answer: "He wishes he could come today" },
{ id: 138, type: 4, question: "Rewrite: They live far from school. (They wish...)", answer: "They wish they lived near school" },
{ id: 139, type: 4, question: "Rewrite: She failed the exam. (She wishes...)", answer: "She wishes she had passed the exam" },
{ id: 140, type: 4, question: "Rewrite: I am busy now. (I wish...)", answer: "I wish I weren't busy now" },

{ id: 141, type: 1, question: "If it stops raining, we _______ out.", options: ["go", "will go", "went", "would go"], answer: "will go" },
{ id: 142, type: 1, question: "If I had a map, I _______ lost.", options: ["won't get", "wouldn't get", "didn't get", "haven't got"], answer: "wouldn't get" },
{ id: 143, type: 1, question: "She wishes she _______ more friends.", options: ["has", "had", "will have", "would have"], answer: "had" },
{ id: 144, type: 1, question: "If he had listened to the teacher, he _______ better.", options: ["does", "did", "would do", "would have done"], answer: "would have done" },
{ id: 145, type: 1, question: "If you study hard, you _______ the exam.", options: ["pass", "passed", "will pass", "would pass"], answer: "will pass" },

{ id: 146, type: 2, question: "wish / I / not / be / late / today.", answer: "I wish I were not late today" },
{ id: 147, type: 2, question: "would / have / we / gone / if / known / had / we.", answer: "If we had known we would have gone" },
{ id: 148, type: 2, question: "if / were / what / you / do / free / you ?", answer: "What would you do if you were free?" },
{ id: 149, type: 2, question: "wish / she / not / forget / my / birthday.", answer: "She wishes she didn't forget my birthday" },
{ id: 150, type: 2, question: "had / saved / if / money / I / bought / would / I / it.", answer: "If I had saved money I would have bought it" }

{ id: 151, type: 1, question: "The boy _______ is standing over there is my brother.", options: ["who", "which", "whom", "whose"], answer: "who" },
{ id: 152, type: 1, question: "The book _______ I bought yesterday is very interesting.", options: ["who", "which", "whose", "where"], answer: "which" },
{ id: 153, type: 1, question: "The girl _______ mother is a teacher lives next door.", options: ["who", "which", "whose", "whom"], answer: "whose" },
{ id: 154, type: 1, question: "This is the place _______ we first met.", options: ["which", "that", "where", "who"], answer: "where" },
{ id: 155, type: 1, question: "The man _______ you met yesterday is my uncle.", options: ["who", "which", "whose", "where"], answer: "who" },

{ id: 156, type: 1, question: "The students _______ study hard will pass the exam.", options: ["which", "who", "whose", "where"], answer: "who" },
{ id: 157, type: 1, question: "The house _______ was built last year is very large.", options: ["who", "which", "whose", "where"], answer: "which" },
{ id: 158, type: 1, question: "That is the girl _______ brother won the prize.", options: ["who", "which", "whose", "whom"], answer: "whose" },
{ id: 159, type: 1, question: "The movie _______ we watched last night was boring.", options: ["who", "which", "where", "whose"], answer: "which" },
{ id: 160, type: 1, question: "The teacher _______ teaches us English is very kind.", options: ["who", "which", "where", "whose"], answer: "who" },

/* ----- Error identification (Type 3) ----- */
{ id: 161, type: 3, question: "The man *which* *lives* *next door* *is* *friendly*.", options: ["which", "lives", "next door", "is", "friendly"], answer: "which" },
{ id: 162, type: 3, question: "The book *who* *I* *borrowed* *is* *interesting*.", options: ["who", "I", "borrowed", "is", "interesting"], answer: "who" },
{ id: 163, type: 3, question: "The girl *whose* *she* *is* *singing* *is* *my friend*.", options: ["whose", "she", "is", "singing", "my friend"], answer: "she" },
{ id: 164, type: 3, question: "The place *which* *we* *met* *there* *is* *beautiful*.", options: ["which", "we", "met", "there", "beautiful"], answer: "there" },
{ id: 165, type: 3, question: "The student *who* *study* *hard* *will* *succeed*.", options: ["who", "study", "hard", "will", "succeed"], answer: "study" },

/* ----- Reported speech: Rewrite (Type 4) ----- */
{ id: 166, type: 4, question: "Rewrite: 'I am a student,' said Nam.", answer: "Nam said he was a student" },
{ id: 167, type: 4, question: "Rewrite: 'I will help you,' she said.", answer: "She said she would help me" },
{ id: 168, type: 4, question: "Rewrite: 'I am doing my homework,' he said.", answer: "He said he was doing his homework" },
{ id: 169, type: 4, question: "Rewrite: 'We have finished the work,' they said.", answer: "They said they had finished the work" },
{ id: 170, type: 4, question: "Rewrite: 'I can't swim,' she said.", answer: "She said she couldn't swim" },

{ id: 171, type: 4, question: "Rewrite: 'I went to Hanoi last year,' he said.", answer: "He said he had gone to Hanoi the year before" },
{ id: 172, type: 4, question: "Rewrite: 'I am tired now,' she said.", answer: "She said she was tired then" },
{ id: 173, type: 4, question: "Rewrite: 'We are studying English,' they said.", answer: "They said they were studying English" },
{ id: 174, type: 4, question: "Rewrite: 'I will call you tomorrow,' he said.", answer: "He said he would call me the next day" },
{ id: 175, type: 4, question: "Rewrite: 'I have lost my keys,' she said.", answer: "She said she had lost her keys" },

/* ----- Mixed multiple choice ----- */
{ id: 176, type: 1, question: "He said that he _______ busy then.", options: ["is", "was", "will be", "has been"], answer: "was" },
{ id: 177, type: 1, question: "She told me that she _______ the test already.", options: ["finishes", "finished", "has finished", "had finished"], answer: "had finished" },
{ id: 178, type: 1, question: "They said they _______ to the party the next day.", options: ["go", "went", "will go", "would go"], answer: "would go" },
{ id: 179, type: 1, question: "He told me that he _______ English very well.", options: ["speaks", "spoke", "spoken", "speaking"], answer: "spoke" },
{ id: 180, type: 1, question: "She said that she _______ busy at that time.", options: ["is", "was", "has been", "will be"], answer: "was" },

/* ----- Sentence rearrangement (Type 2) ----- */
{ id: 181, type: 2, question: "boy / who / the / is / playing / my / brother / football.", answer: "The boy who is playing football is my brother" },
{ id: 182, type: 2, question: "said / he / tired / was / that / he.", answer: "He said that he was tired" },
{ id: 183, type: 2, question: "girl / whose / doctor / is / mother / the / my / friend / is.", answer: "The girl whose mother is a doctor is my friend" },
{ id: 184, type: 2, question: "she / said / would / she / come / later / that.", answer: "She said that she would come later" },
{ id: 185, type: 2, question: "the / which / book / reading / am / I / interesting / is.", answer: "The book which I am reading is interesting" },

/* ----- More mixed questions ----- */
{ id: 186, type: 1, question: "The man _______ car was stolen called the police.", options: ["who", "which", "whose", "where"], answer: "whose" },
{ id: 187, type: 1, question: "This is the school _______ I studied last year.", options: ["who", "which", "where", "whose"], answer: "where" },
{ id: 188, type: 1, question: "She said that she _______ her homework.", options: ["does", "did", "has done", "had done"], answer: "had done" },
{ id: 189, type: 1, question: "The people _______ live here are very friendly.", options: ["who", "which", "whose", "where"], answer: "who" },
{ id: 190, type: 1, question: "He told me that he _______ me the day before.", options: ["meets", "met", "has met", "had met"], answer: "had met" },

{ id: 191, type: 4, question: "Rewrite: 'I am going to the library,' she said.", answer: "She said she was going to the library" },
{ id: 192, type: 4, question: "Rewrite: 'We will finish it soon,' they said.", answer: "They said they would finish it soon" },
{ id: 193, type: 4, question: "Rewrite: 'I don‚Äôt like math,' he said.", answer: "He said he didn‚Äôt like math" },
{ id: 194, type: 4, question: "Rewrite: 'I am watching TV now,' Nam said.", answer: "Nam said he was watching TV then" },
{ id: 195, type: 4, question: "Rewrite: 'I have lived here for years,' she said.", answer: "She said she had lived there for years" },

{ id: 196, type: 3, question: "The boy *who* *she* *likes* *is* *very* *kind*.", options: ["who", "she", "likes", "is", "kind"], answer: "she" },
{ id: 197, type: 3, question: "He said *that* *he* *will* *come* *later*.", options: ["that", "he", "will", "come", "later"], answer: "will" },
{ id: 198, type: 3, question: "The place *where* *we* *met* *there* *was* *crowded*.", options: ["where", "we", "met", "there", "crowded"], answer: "there" },
{ id: 199, type: 3, question: "She said *she* *is* *happy* *then*.", options: ["she", "is", "happy", "then"], answer: "is" },
{ id: 200, type: 3, question: "The student *which* *won* *the prize* *is* *my friend*.", options: ["which", "won", "the prize", "is", "my friend"], answer: "which" }
        ];

        let currentPlayer = { name: "", class: "", score: 0 };
        let currentQuestions = [];
        let currentIndex = 0;
        let timeLeft = 25 * 60;
        let timer;

        function showScreen(id) {
            document.querySelectorAll('.container > div').forEach(d => d.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }

        function toggleMusic() {
            const m = document.getElementById('bg-music');
            const btn = document.querySelector('.music-control');
            if (m.paused) { m.play(); btn.innerText = "üîä"; }
            else { m.pause(); btn.innerText = "üîá"; }
        }

        function startGame() {
            const name = document.getElementById('player-name').value;
            const cls = document.getElementById('player-class').value;
            if(!name || !cls) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin!");
            
            currentPlayer = { name, class: cls, score: 0 };
            document.getElementById('display-info').innerText = name + " - " + cls;
            
            // L·∫•y 20 c√¢u ng·∫´u nhi√™n
            currentQuestions = [...fullQuestionBank].sort(() => 0.5 - Math.random()).slice(0, 20);
            currentIndex = 0;
            timeLeft = 25 * 60;
            
            showScreen('game-screen');
            loadQuestion();
            timer = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            timeLeft--;
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
            if(timeLeft <= 0) { clearInterval(timer); alert("H·∫øt gi·ªù!"); location.reload(); }
        }

        function loadQuestion() {
            if(currentIndex >= currentQuestions.length) return endGame();
            
            const q = currentQuestions[currentIndex];
            const area = document.getElementById('answer-area');
            const txt = document.getElementById('question-text');
            const title = document.getElementById('question-type-title');
            
            area.innerHTML = "";
            txt.innerText = q.question.replace(/\*/g, "");
            document.getElementById('feedback').innerText = "";

            if(q.type === 1 || q.type === 3) {
                title.innerText = q.type === 1 ? "Ch·ªçn ƒë√°p √°n ƒë√∫ng" : "T√¨m l·ªói sai";
                let grid = document.createElement('div');
                grid.className = "options-grid";
                q.options.forEach(opt => {
                    let b = document.createElement('button');
                    b.innerText = opt;
                    b.onclick = () => check(opt, q.answer);
                    grid.appendChild(b);
                });
                area.appendChild(grid);
            } else {
                title.innerText = q.type === 2 ? "Gh√©p th√†nh c√¢u ƒë√∫ng" : "Vi·∫øt l·∫°i c√¢u ƒë√∫ng";
                let inp = document.createElement('input');
                inp.id = "user-inp";
                let b = document.createElement('button');
                b.innerText = "G·ª¨I";
                b.onclick = () => check(document.getElementById('user-inp').value, q.answer);
                area.appendChild(inp); area.appendChild(b);
            }
        }

        function check(user, correct) {
            const f = document.getElementById('feedback');
            if(user.trim().toLowerCase().replace(/[.?!]/g,"") === correct.toLowerCase().replace(/[.?!]/g,"")) {
                currentPlayer.score += 10;
                document.getElementById('score').innerText = currentPlayer.score;
                f.innerText = "Ch√≠nh x√°c! +10"; f.style.color = "lime";
                setTimeout(() => { currentIndex++; loadQuestion(); }, 1000);
            } else {
                f.innerText = "Sai r·ªìi! ƒê·ªïi c√¢u h·ªèi kh√°c..."; f.style.color = "red";
                // ƒê·ªïi c√¢u h·ªèi kh√°c
                let newQ = fullQuestionBank[Math.floor(Math.random()*fullQuestionBank.length)];
                currentQuestions[currentIndex] = newQ;
                setTimeout(loadQuestion, 1500);
            }
        }

        function endGame() {
            clearInterval(timer);
            showScreen('result-screen');
            document.getElementById('final-score').innerText = "ƒêi·ªÉm: " + currentPlayer.score;
            document.getElementById('gems').innerText = Math.floor(currentPlayer.score/10);
            saveLeaderboard();
        }

        function saveLeaderboard() {
            let lb = JSON.parse(localStorage.getItem('eng_lb') || "[]");
            lb.push(currentPlayer);
            lb.sort((a,b) => b.score - a.score);
            localStorage.setItem('eng_lb', JSON.stringify(lb.slice(0,10)));
        }

        function showLeaderboard() {
            showScreen('leaderboard-screen');
            const tbody = document.querySelector('tbody');
            tbody.innerHTML = "";
            let lb = JSON.parse(localStorage.getItem('eng_lb') || "[]");
            lb.forEach((p, i) => {
                tbody.innerHTML += `<tr><td>${i+1}</td><td>${p.name}</td><td>${p.class}</td><td>${p.score}</td></tr>`;
            });
        }

        // V·∫Ω hi·ªáu ·ª©ng Canvas background cho m∆∞·ª£t
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let pts = [];
        function initCanvas() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            pts = [];
            for(let i=0; i<50; i++) pts.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: Math.random()*2, d: Math.random()*2*Math.PI});
        }
        function animate() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "#00f2ff";
            pts.forEach(p => {
                p.x += Math.cos(p.d) * 0.5; p.y += Math.sin(p.d) * 0.5;
                if(p.x < 0) p.x = canvas.width; if(p.y < 0) p.y = canvas.height;
                if(p.x > canvas.width) p.x = 0; if(p.y > canvas.height) p.y = 0;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(animate);
        }
        window.onresize = initCanvas;
        initCanvas(); animate();
    </script>
</body>
</html>
