<!DOCTYPE html>
<html lang="vi" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>English Tech Master - THCS</title>
    <style>
        /* --- CSS: GIAO DI·ªÜN C√îNG NGH·ªÜ --- */
        :root {
            --bg-color: #0f0c29;
            --gradient: linear-gradient(to right, #0f0c29, #302b63, #24243e);
            --neon-blue: #00f2ff;
            --neon-purple: #bc13fe;
            --text-color: #fff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gradient);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            user-select: none; /* Ch·ªëng b√¥i ƒëen copy */
            -webkit-user-select: none;
        }

        /* Ch·ªëng chu·ªôt ph·∫£i */
        body.no-context {
            pointer-events: auto;
        }

        /* CONTAINER CH√çNH */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            position: relative;
            z-index: 1;
        }

        /* M√ÄN H√åNH ƒêƒÇNG NH·∫¨P */
        #login-screen, #game-screen, #result-screen, #leaderboard-screen {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
            text-align: center;
            max-width: 800px;
            width: 90%;
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
        }

        #login-screen { display: block; } /* Hi·ªán login ƒë·∫ßu ti√™n */

        h1, h2 {
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--neon-purple);
            margin-bottom: 20px;
        }

        input {
            width: 80%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--neon-blue);
            color: white;
            font-size: 16px;
            border-radius: 5px;
            outline: none;
        }

        button {
            padding: 12px 30px;
            margin: 10px;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple));
            border: none;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            border-radius: 50px;
            transition: 0.3s;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--neon-purple);
        }

        /* HUD GAME */
        .hud {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
            font-size: 18px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        .timer { color: var(--neon-blue); font-weight: bold; }
        .score { color: #00ff00; }

        /* KHUNG C√ÇU H·ªéI */
        .question-box {
            font-size: 22px;
            margin: 20px 0;
            min-height: 100px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--neon-purple);
            box-shadow: none;
        }

        .option-btn:hover {
            background: var(--neon-purple);
        }

        /* B·∫¢NG X·∫æP H·∫†NG */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        th { color: var(--neon-blue); }

        /* MUSIC CONTROL */
        .music-control {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }

        /* H·ªÜ TH·ªêNG H·∫†T (Background Effect) */
        .particles {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }
    </style>
</head>
<body oncontextmenu="return false;"> <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8c8a73467.mp3?filename=cyberpunk-2099-105864.mp3" type="audio/mpeg">
    </audio>
    
    <div class="music-control" onclick="toggleMusic()">üîä</div>

    <div class="particles" id="particles"></div>

    <div class="container">
        <div id="login-screen">
            <h1>Tech English Master</h1>
            <p>Nh·∫≠p th√¥ng tin ƒë·ªÉ b·∫Øt ƒë·∫ßu th·ª≠ th√°ch</p>
            <input type="text" id="player-name" placeholder="H·ªç v√† T√™n">
            <input type="text" id="player-class" placeholder="L·ªõp (V√≠ d·ª•: 9A)">
            <br>
            <button onclick="startGame()">B·∫ÆT ƒê·∫¶U (START)</button>
            <button onclick="showLeaderboard()">B·∫¢NG X·∫æP H·∫†NG</button>
        </div>

        <div id="game-screen">
            <div class="hud">
                <span id="display-info">Player: ...</span>
                <span class="timer" id="timer">25:00</span>
                <span class="score" id="score">ƒêi·ªÉm: 0</span>
            </div>
            
            <div id="game-area">
                <h3 id="question-type-title" style="color: var(--neon-purple)">Lo·∫°i c√¢u h·ªèi</h3>
                <div class="question-box" id="question-text">Loading...</div>
                
                <div id="answer-area"></div>
                <div id="feedback" style="height: 30px; margin-top: 10px; font-weight: bold;"></div>
            </div>
        </div>

        <div id="result-screen">
            <h1 id="result-title">HO√ÄN TH√ÄNH!</h1>
            <p id="final-score">ƒêi·ªÉm s·ªë: 0</p>
            <div style="font-size: 50px;">üíé <span id="gems">0</span></div>
            <p>B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c ph·∫ßn th∆∞·ªüng ƒë√° qu√Ω!</p>
            <button onclick="resetGame()">CH∆†I L·∫†I</button>
            <button onclick="showLeaderboard()">XEM B·∫¢NG X·∫æP H·∫†NG</button>
        </div>

        <div id="leaderboard-screen">
            <h2>B·∫¢NG X·∫æP H·∫†NG (TOP 10)</h2>
            <table id="leaderboard-table">
                <thead>
                    <tr>
                        <th>H·∫°ng</th>
                        <th>T√™n</th>
                        <th>L·ªõp</th>
                        <th>ƒêi·ªÉm</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button onclick="goHome()">QUAY V·ªÄ</button>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH D·ªÆ LI·ªÜU ---
        // ƒê·ªÉ c√≥ 1000-3000 c√¢u, b·∫°n c·∫ßn copy paste th√™m v√†o m·∫£ng n√†y.
        // type: 1=Tr·∫Øc nghi·ªám, 2=Gh√©p t·ª´, 3=T√¨m l·ªói, 4=S·ª≠a c√¢u
        const fullQuestionBank = [
            // --- PH·∫¶N 1: TR·∫ÆC NGHI·ªÜM (MULTIPLE CHOICE) ---
    { id: 1, type: 1, question: "She _____ to school every day.", options: ["go", "goes", "going", "went"], answer: "goes" },
    { id: 2, type: 1, question: "I haven't seen him _____ 2015.", options: ["since", "for", "in", "at"], answer: "since" },
    { id: 3, type: 1, question: "If it rains, we _____ at home.", options: ["stay", "would stay", "will stay", "stayed"], answer: "will stay" },
    { id: 4, type: 1, question: "This is the book _____ I bought yesterday.", options: ["who", "whom", "which", "where"], answer: "which" },
    { id: 5, type: 1, question: "My father enjoys _____ newspapers in the morning.", options: ["read", "reading", "to read", "reads"], answer: "reading" },
    { id: 6, type: 1, question: "Would you mind _____ the window?", options: ["close", "closing", "to close", "closed"], answer: "closing" },
    { id: 7, type: 1, question: "He is the _____ student in my class.", options: ["tall", "taller", "tallest", "most tall"], answer: "tallest" },
    { id: 8, type: 1, question: "We used to _____ in the countryside.", options: ["live", "living", "lived", "lives"], answer: "live" },
    { id: 9, type: 1, question: "Nam speaks English very _____.", options: ["good", "well", "bad", "slow"], answer: "well" },
    { id: 10, type: 1, question: "The car _____ in Japan is very expensive.", options: ["make", "making", "made", "to make"], answer: "made" },
    { id: 11, type: 1, question: "I wish I _____ a car now.", options: ["have", "had", "will have", "am having"], answer: "had" },
    { id: 12, type: 1, question: "Remember _____ off the lights before leaving.", options: ["turn", "turning", "to turn", "turned"], answer: "to turn" },
    
    // --- PH·∫¶N 2: GH√âP T·ª™ (WORD SCRAMBLE) ---
    // L∆∞u √Ω: answer ph·∫£i vi·∫øt ƒë√∫ng chu·∫©n ng·ªØ ph√°p
    { id: 13, type: 2, question: "is / name / My / John.", answer: "My name is John" },
    { id: 14, type: 2, question: "you / Do / like / music?", answer: "Do you like music" },
    { id: 15, type: 2, question: "beautiful / is / She / a / girl.", answer: "She is a beautiful girl" },
    { id: 16, type: 2, question: "learning / English / I / am / now.", answer: "I am learning English now" },
    { id: 17, type: 2, question: "go / Let's / for / a / walk.", answer: "Let's go for a walk" },
    { id: 18, type: 2, question: "homework / Have / finished / you / your?", answer: "Have you finished your homework" },
    { id: 19, type: 2, question: "interested / is / He / in / soccer.", answer: "He is interested in soccer" },
    { id: 20, type: 2, question: "car / than / faster / plane / A / is / a / not.", answer: "A car is not faster than a plane" },
    { id: 21, type: 2, question: "forward / looking / to / I / am / you / seeing.", answer: "I am looking forward to seeing you" },
    { id: 22, type: 2, question: "enough / old / isn't / She / to / drive.", answer: "She isn't old enough to drive" },
    { id: 23, type: 2, question: "long / How / you / lived / have / here?", answer: "How long have you lived here" },
    { id: 24, type: 2, question: "idea / good / That / is / a.", answer: "That is a good idea" },

    // --- PH·∫¶N 3: T√åM L·ªñI SAI (FIND MISTAKE) ---
    // Question ch·ª©a to√†n b·ªô c√¢u, options l√† c√°c t·ª´ g·∫°ch ch√¢n, answer l√† t·ª´ sai
    { id: 25, type: 3, question: "He *go* to *school* by *bus* every *morning*.", options: ["go", "school", "bus", "morning"], answer: "go" },
    { id: 26, type: 3, question: "She *enjoy* *listening* to *music* in *her* free time.", options: ["enjoy", "listening", "music", "her"], answer: "enjoy" },
    { id: 27, type: 3, question: "My *mother* bought *me* a *new* bike *yesterday*.", options: ["mother", "me", "new", "yesterday"], answer: "" }, // C√¢u n√†y ƒë√∫ng (Trick question - ·ªü ƒë√¢y ta gi·∫£ s·ª≠ ph·∫£i c√≥ l·ªói, v√≠ d·ª• s·ª≠a bought -> buyed ƒë·ªÉ t·∫°o l·ªói) -> S·ª≠a l·∫°i data d∆∞·ªõi:
    { id: 27, type: 3, question: "My mother *buyed* me *a* new *bike* yesterday.", options: ["buyed", "a", "bike", "yesterday"], answer: "buyed" },
    { id: 28, type: 3, question: "*Although* he is *old*, but he *runs* very *fast*.", options: ["Although", "old", "runs", "fast"], answer: "Although" }, // Ho·∫∑c b·ªè "but". Trong tr·∫Øc nghi·ªám l·ªói sai th∆∞·ªùng ch·ªçn Although ho·∫∑c but
    { id: 29, type: 3, question: "We *look* forward *to* *see* you *soon*.", options: ["look", "to", "see", "soon"], answer: "see" }, // S·ª≠a th√†nh seeing
    { id: 30, type: 3, question: "This is the *best* book *what* I *have* ever *read*.", options: ["best", "what", "have", "read"], answer: "what" },
    { id: 31, type: 3, question: "Unless *you* don't *work* hard, you *will* fail *the* exam.", options: ["you", "work", "will", "the"], answer: "don't" }, // L·ªói logic ph·ªß ƒë·ªãnh k√©p
    { id: 32, type: 3, question: "There *is* many *people* in *the* room *now*.", options: ["is", "people", "the", "now"], answer: "is" },
    { id: 33, type: 3, question: "Let's *going* to *the* cinema *tonight*, *shall* we?", options: ["going", "the", "tonight", "shall"], answer: "going" },
    { id: 34, type: 3, question: "She *asked* me *where* did *I* live.", options: ["asked", "where", "did", "I"], answer: "did" }, // Sai tr·∫≠t t·ª± t·ª´ c√¢u gi√°n ti·∫øp
    { id: 35, type: 3, question: "*Neither* Mary *nor* her friends *is* going *to* the party.", options: ["Neither", "nor", "is", "to"], answer: "is" }, // Chia theo danh t·ª´ s·ªë nhi·ªÅu g·∫ßn nh·∫•t (friends -> are)
    { id: 36, type: 3, question: "If I *am* you, I *would* learn *harder* for the *test*.", options: ["am", "would", "harder", "test"], answer: "am" }, // C√¢u ƒëi·ªÅu ki·ªán lo·∫°i 2 -> were

    // --- PH·∫¶N 4: VI·∫æT L·∫†I C√ÇU (SENTENCE CORRECTION/REWRITE) ---
    { id: 37, type: 4, question: "He don't like playing football.", answer: "He doesn't like playing football" },
    { id: 38, type: 4, question: "Where did you went yesterday?", answer: "Where did you go yesterday" },
    { id: 39, type: 4, question: "My homework have been finished.", answer: "My homework has been finished" },
    { id: 40, type: 4, question: "She walks slow.", answer: "She walks slowly" },
    { id: 41, type: 4, question: "I haven't saw him for a long time.", answer: "I haven't seen him for a long time" },
    { id: 42, type: 4, question: "This house was build in 1990.", answer: "This house was built in 1990" },
    { id: 43, type: 4, question: "Rewrite: People speak English all over the world. (Passive Voice)", answer: "English is spoken all over the world" },
    { id: 44, type: 4, question: "Rewrite: 'I am tired,' she said. (Reported Speech)", answer: "She said she was tired" },
    { id: 45, type: 4, question: "Rewrite: He is too short to play basketball. (Use 'tall')", answer: "He is not tall enough to play basketball" },
    { id: 46, type: 4, question: "Rewrite: It's a pity I can't swim. (Use 'wish')", answer: "I wish I could swim" },
    { id: 47, type: 4, question: "Rewrite: Shall we go to the park? (Use 'Suggest')", answer: "I suggest going to the park" },
    { id: 48, type: 4, question: "Rewrite: He drives dangerously. (He is a...)", answer: "He is a dangerous driver" }
            // PART 1: MULTIPLE CHOICE (Tr·∫Øc nghi·ªám)
            { id: 49, type: 1, question: "She _____ to school every day.", options: ["go", "goes", "going", "went"], answer: "goes" },
            { id: 50, type: 1, question: "I haven't seen him _____ 2015.", options: ["since", "for", "in", "at"], answer: "since" },
            { id: 51, type: 1, question: "If it rains, we _____ at home.", options: ["stay", "would stay", "will stay", "stayed"], answer: "will stay" },
            { id: 52, type: 1, question: "This is the book _____ I bought yesterday.", options: ["who", "whom", "which", "where"], answer: "which" },
            
            // PART 2: WORD SCRAMBLE (Gh√©p t·ª´)
            { id: 53, type: 2, question: "is / name / My / John.", answer: "My name is John" },
            { id: 54, type: 2, question: "you / Do / like / music?", answer: "Do you like music" },
            { id: 55, type: 2, question: "beautiful / is / She / a / girl.", answer: "She is a beautiful girl" },

            // PART 3: FIND MISTAKE (T√¨m l·ªói sai - ng∆∞·ªùi ch∆°i ch·ªçn t·ª´ sai)
            // Format: question l√† c√¢u ƒë·∫ßy ƒë·ªß, options l√† c√°c ph·∫ßn g·∫°ch ch√¢n, answer l√† ph·∫ßn b·ªã sai.
            { id: 56, type: 3, question: "He *go* to *school* by *bus* every *morning*.", options: ["go", "school", "bus", "morning"], answer: "go" },
            { id: 57, type: 3, question: "She *enjoy* *listening* to *music* in *her* free time.", options: ["enjoy", "listening", "music", "her"], answer: "enjoy" },

            // PART 4: SENTENCE CORRECTION (S·ª≠a c√¢u)
            { id: 58, type: 4, question: "He don't like playing football.", answer: "He doesn't like playing football" },
            { id: 58 type: 4, question: "Where did you went yesterday?", answer: "Where did you go yesterday" }
        ];

        // M·ªü r·ªông m·∫£ng tr√™n ƒë·ªÉ c√≥ ƒë·ªß 1000 c√¢u. 
        // Logic game s·∫Ω t·ª± l·ªçc v√† l·∫•y ng·∫´u nhi√™n.

        // --- BI·∫æN TR·∫†NG TH√ÅI GAME ---
        let currentPlayer = { name: "", class: "", score: 0 };
        let currentLevelQuestions = [];
        let currentQuestionIndex = 0;
        let timerInterval;
        let timeLeft = 25 * 60; // 25 ph√∫t
        let isMusicPlaying = false;
        const questionsPerLevel = 20;

        // --- H·ªÜ TH·ªêNG AUDIO ---
        const audio = document.getElementById("bg-music");
        function toggleMusic() {
            if (isMusicPlaying) {
                audio.pause();
                document.querySelector('.music-control').innerText = "üîá";
            } else {
                audio.play();
                document.querySelector('.music-control').innerText = "üîä";
            }
            isMusicPlaying = !isMusicPlaying;
        }

        // --- LOGIC CH√çNH ---

        function showScreen(screenId) {
            document.querySelectorAll('.container > div').forEach(div => div.style.display = 'none');
            document.getElementById(screenId).style.display = 'block';
        }

        function startGame() {
            const name = document.getElementById('player-name').value;
            const cls = document.getElementById('player-class').value;
            if (!name || !cls) { alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!"); return; }

            currentPlayer.name = name;
            currentPlayer.class = cls;
            currentPlayer.score = 0;
            
            document.getElementById('display-info').innerText = `${name} - ${cls}`;
            document.getElementById('score').innerText = `ƒêi·ªÉm: 0`;

            // T·∫°o b·ªô c√¢u h·ªèi ng·∫´u nhi√™n cho m√†n ch∆°i
            generateLevelQuestions();
            
            // Reset Timer
            timeLeft = 25 * 60;
            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);

            showScreen('game-screen');
            loadQuestion();
            
            // T·ª± ƒë·ªông b·∫≠t nh·∫°c n·∫øu ch∆∞a b·∫≠t (c·∫ßn t∆∞∆°ng t√°c ng∆∞·ªùi d√πng tr∆∞·ªõc)
            if(!isMusicPlaying) toggleMusic();
        }

        function generateLevelQuestions() {
            // L·∫•y ng·∫´u nhi√™n 20 c√¢u t·ª´ ng√¢n h√†ng c√¢u h·ªèi
            // ƒê·∫£m b·∫£o tr·ªôn l·∫´n 4 lo·∫°i (ƒë∆°n gi·∫£n h√≥a b·∫±ng c√°ch l·∫•y random to√†n b·ªô)
            let shuffled = [...fullQuestionBank].sort(() => 0.5 - Math.random());
            currentLevelQuestions = shuffled.slice(0, questionsPerLevel);
            currentQuestionIndex = 0;
        }

        function updateTimer() {
            let m = Math.floor(timeLeft / 60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
            timeLeft--;

            if (timeLeft < 0) {
                clearInterval(timerInterval);
                alert("H·∫øt gi·ªù! ƒêang t·∫£i l·∫°i b·ªô c√¢u h·ªèi m·ªõi...");
                startGame(); // Restart
            }
        }

        function loadQuestion() {
            if (currentQuestionIndex >= currentLevelQuestions.length) {
                endGame();
                return;
            }

            const q = currentLevelQuestions[currentQuestionIndex];
            const qBox = document.getElementById('question-text');
            const ansArea = document.getElementById('answer-area');
            const typeTitle = document.getElementById('question-type-title');
            const feedback = document.getElementById('feedback');
            
            feedback.innerText = "";
            ansArea.innerHTML = "";
            qBox.innerHTML = q.question.replace(/\*/g, ""); // X√≥a k√Ω t·ª± ƒë√°nh d·∫•u n·∫øu c√≥

            // X·ª≠ l√Ω hi·ªÉn th·ªã theo lo·∫°i
            if (q.type === 1) { // Tr·∫Øc nghi·ªám
                typeTitle.innerText = "Ph·∫ßn 1: Ch·ªçn ƒë√°p √°n ƒë√∫ng";
                let optsDiv = document.createElement('div');
                optsDiv.className = 'options-grid';
                q.options.forEach(opt => {
                    let btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerText = opt;
                    btn.onclick = () => checkAnswer(opt, q.answer, q);
                    optsDiv.appendChild(btn);
                });
                ansArea.appendChild(optsDiv);
            } 
            else if (q.type === 2) { // Gh√©p t·ª´
                typeTitle.innerText = "Ph·∫ßn 2: S·∫Øp x·∫øp th√†nh c√¢u ƒë√∫ng";
                let input = document.createElement('input');
                input.placeholder = "Nh·∫≠p c√¢u ho√†n ch·ªânh...";
                input.id = "user-input";
                let btn = document.createElement('button');
                btn.innerText = "Ki·ªÉm tra";
                btn.onclick = () => checkAnswer(document.getElementById('user-input').value, q.answer, q);
                ansArea.appendChild(input);
                ansArea.appendChild(btn);
            }
            else if (q.type === 3) { // T√¨m l·ªói sai
                typeTitle.innerText = "Ph·∫ßn 3: Ch·ªçn t·ª´ b·ªã sai";
                qBox.innerHTML = ""; // Render l·∫°i c√¢u h·ªèi d·∫°ng click
                // T√°ch c√¢u th√†nh c√°c ph·∫ßn d·ª±a tr√™n config (ƒë∆°n gi·∫£n h√≥a ·ªü ƒë√¢y)
                // V·ªõi demo: ta hi·ªÉn th·ªã c√°c options ƒë·ªÉ user ch·ªçn c√°i n√†o sai
                let partsDiv = document.createElement('div');
                q.options.forEach(opt => {
                    let btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.innerText = opt;
                    btn.onclick = () => checkAnswer(opt, q.answer, q);
                    partsDiv.appendChild(btn);
                });
                ansArea.appendChild(partsDiv);
            }
            else if (q.type === 4) { // S·ª≠a c√¢u
                typeTitle.innerText = "Ph·∫ßn 4: Vi·∫øt l·∫°i c√¢u cho ƒë√∫ng";
                let input = document.createElement('input');
                input.placeholder = "Vi·∫øt l·∫°i c√¢u ƒë√∫ng...";
                input.id = "user-input";
                let btn = document.createElement('button');
                btn.innerText = "G·ª≠i";
                btn.onclick = () => checkAnswer(document.getElementById('user-input').value, q.answer, q);
                ansArea.appendChild(input);
                ansArea.appendChild(btn);
            }
        }

        function checkAnswer(userAns, correctAns, currentQ) {
            // Chu·∫©n h√≥a chu·ªói (x√≥a kho·∫£ng tr·∫Øng th·ª´a, kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng)
            let u = userAns.trim().toLowerCase().replace(/[.,!?]/g, "");
            let c = correctAns.trim().toLowerCase().replace(/[.,!?]/g, "");
            
            const feedback = document.getElementById('feedback');

            if (u === c) {
                // ƒê√öNG
                feedback.style.color = "#00ff00";
                feedback.innerText = "Correct! +10 Points";
                currentPlayer.score += 10;
                document.getElementById('score').innerText = `ƒêi·ªÉm: ${currentPlayer.score}`;
                
                // Qua c√¢u ti·∫øp theo
                setTimeout(() => {
                    currentQuestionIndex++;
                    loadQuestion();
                }, 1000);
            } else {
                // SAI
                feedback.style.color = "red";
                feedback.innerText = "Wrong! Changing question...";
                
                // Logic: Thay th·∫ø c√¢u h·ªèi hi·ªán t·∫°i b·∫±ng m·ªôt c√¢u h·ªèi ng·∫´u nhi√™n KH√ÅC t·ª´ ng√¢n h√†ng
                // ƒê·ªÉ ƒë∆°n gi·∫£n: L·∫•y 1 c√¢u random t·ª´ fullQuestionBank tr·ª´ c√¢u hi·ªán t·∫°i
                let newQ;
                do {
                    newQ = fullQuestionBank[Math.floor(Math.random() * fullQuestionBank.length)];
                } while (newQ.id === currentQ.id);

                // Thay th·∫ø c√¢u h·ªèi t·∫°i v·ªã tr√≠ hi·ªán t·∫°i
                currentLevelQuestions[currentQuestionIndex] = newQ;
                
                setTimeout(() => {
                    loadQuestion();
                }, 1500);
            }
        }

        function endGame() {
            clearInterval(timerInterval);
            showScreen('result-screen');
            document.getElementById('final-score').innerText = `ƒêi·ªÉm t·ªïng k·∫øt: ${currentPlayer.score}`;
            document.getElementById('gems').innerText = Math.floor(currentPlayer.score / 10); // 10 ƒëi·ªÉm = 1 ƒë√° qu√Ω
            
            saveToLeaderboard();
        }

        // --- B·∫¢NG X·∫æP H·∫†NG (LOCAL STORAGE) ---
        function saveToLeaderboard() {
            let lb = JSON.parse(localStorage.getItem('tech_english_lb')) || [];
            lb.push(currentPlayer);
            lb.sort((a, b) => b.score - a.score); // S·∫Øp x·∫øp gi·∫£m d·∫ßn
            localStorage.setItem('tech_english_lb', JSON.stringify(lb));
        }

        function showLeaderboard() {
            showScreen('leaderboard-screen');
            const tbody = document.querySelector('#leaderboard-table tbody');
            tbody.innerHTML = "";
            let lb = JSON.parse(localStorage.getItem('tech_english_lb')) || [];
            
            lb.slice(0, 10).forEach((p, index) => { // Top 10
                let row = `<tr>
                    <td>${index + 1}</td>
                    <td>${p.name}</td>
                    <td>${p.class}</td>
                    <td>${p.score}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function goHome() {
            showScreen('login-screen');
        }
        
        function resetGame() {
            startGame();
        }

        // --- CH·ªêNG GIAN L·∫¨N ---
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if(e.keyCode == 123) { return false; } // F12
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)){ return false; }
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)){ return false; }
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)){ return false; }
            if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)){ return false; }
        }

    </script>
</body>
</html>
